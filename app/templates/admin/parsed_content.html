<section>
    <h2 class="text-2xl font-semibold mb-4">Parsed Content</h2>
    <div class="mb-4">
        <button id="showAddContentForm" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Add New Content
        </button>
    </div>
    <div id="addContentForm" class="hidden mb-4 p-4 bg-gray-100 rounded">
        <h3 class="text-xl font-semibold mb-2">Add New Parsed Content</h3>
        <form action="{{ url_for('rss_manager.get_parsed_content', feed_id=feed_id) }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="mb-2">
                <label for="title" class="block">Title:</label>
                <input type="text" id="title" name="title" required class="w-full px-2 py-1 border rounded">
            </div>
            <div class="mb-2">
                <label for="url" class="block">URL:</label>
                <input type="url" id="url" name="url" required class="w-full px-2 py-1 border rounded">
            </div>
            <div class="mb-2">
                <label for="description" class="block">Description:</label>
                <textarea id="description" name="description" required class="w-full px-2 py-1 border rounded"></textarea>
            </div>
            <div class="mb-2">
                <label for="date" class="block">Date:</label>
                <input type="date" id="date" name="date" required class="w-full px-2 py-1 border rounded">
            </div>
            <div class="mb-2">
                <label for="source_type" class="block">Source Type:</label>
                <input type="text" id="source_type" name="source_type" required class="w-full px-2 py-1 border rounded">
            </div>
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                Add Content
            </button>
        </form>
    </div>
    <div id="parsed-content-table"></div>
</section>

<script src="{{ url_for('static', filename='js/node_modules/gridjs/dist/gridjs.umd.js') }}"></script>
<link href="{{ url_for('static', filename='js/node_modules/gridjs/dist/theme/mermaid.min.css') }}" rel="stylesheet" />

<script>
    document.addEventListener('DOMContentLoaded', function() {
        new gridjs.Grid({
            columns: [
                { 
                    id: 'title', 
                    name: 'Title',
                    formatter: (cell, row) => gridjs.html(`<a href="/view/${row.cells[4].data}" class="text-blue-500 hover:underline">${cell}</a>`)
                },
                { 
                    id: 'url', 
                    name: 'URL',
                    formatter: (cell) => gridjs.html(`<a href="${cell}" target="_blank" class="text-blue-500 hover:underline">${cell}</a>`)
                },
                { id: 'date', name: 'Date' },
                { id: 'source_type', name: 'Source Type' },
                {
                    id: 'actions',
                    name: 'Actions',
                    formatter: (_, row) => gridjs.html(`
                        <a href="{{ url_for('rss_manager.manage_rss') }}?content_id=${row.cells[4].data}" class="text-yellow-500 hover:underline mr-2">Edit</a>
                        <form action="{{ url_for('rss_manager.manage_rss') }}?content_id=${row.cells[4].data}" method="post" class="inline">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="text-red-500 hover:underline" onclick="return confirm('Are you sure you want to delete this content?')">Delete</button>
                        </form>
                    `)
                }
            ],
            data: [
                {% for content in parsed_content %}
                    [
                        "{{ content.title | replace('"', '\\"') }}",
                        "{{ content.url | replace('"', '\\"') }}",
                        "{{ content.date }}",
                        "{{ content.source_type | replace('"', '\\"') }}",
                        "{{ content.id }}"
                    ],
                {% endfor %}
            ],
            search: true,
            sort: true,
            pagination: {
                limit: 10
            }
        }).render(document.getElementById("parsed-content-table"));
    });
</script>
