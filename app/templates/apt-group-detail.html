{% extends "base.html" %}

{% block title %}{{ group.actor }} - APT Group Detail{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-8 text-center text-gray-800">{{ group.actor }}</h1>
    
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="p-6">
            <p class="text-lg text-gray-700 mb-4"><strong>Description:</strong> {{ group.description }}</p>
            {% if affiliate_groups %}
            <div class="mb-4">
                <h2 class="text-2xl font-semibold mb-2">Affiliate Groups:</h2>
                <ul class="list-disc list-inside">
                    {% for affiliate in affiliate_groups %}
                    <li><a href="{{ url_for('apt.apt_group_detail', group_uuid=affiliate.uuid) }}" class="text-blue-500 hover:underline">{{ affiliate.actor }}</a></li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            <p class="text-lg text-gray-700 mb-4"><strong>Country:</strong> {{ group.country }}</p>
            <p class="text-lg text-gray-700 mb-4"><strong>Motivation:</strong> {{ group.motivation }}</p>
            <p class="text-lg text-gray-700 mb-4"><strong>First Seen:</strong> {{ group.first_seen }}</p>
            <p class="text-lg text-gray-700 mb-4"><strong>Observed Sectors:</strong> {{ group.observed_sectors }}</p>
            <p class="text-lg text-gray-700 mb-4"><strong>Observed Countries:</strong> {{ group.observed_countries }}</p>
            <p class="text-lg text-gray-700 mb-4"><strong>Tools:</strong> 
                {% for tool in group.tools.split(', ') %}
                    <a href="{{ url_for('apt.apt_tool_detail', tool_name=tool.strip()) }}" class="text-blue-500 hover:underline">{{ tool.strip() }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </p>
            <p class="text-lg text-gray-700 mb-4"><strong>Sponsor:</strong> {{ group.sponsor }}</p>
            
            {% if group.names %}
            <div class="mb-4">
                <h2 class="text-2xl font-semibold mb-2">Alternative Names:</h2>
                <ul class="list-disc list-inside">
                    {% for name in group.names %}
                    <li>{{ name.name }} ({{ name.name_giver }})</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            {% if group.operations %}
            <div class="mb-4">
                <h2 class="text-2xl font-semibold mb-2">Operations:</h2>
                <table class="min-w-full bg-white">
                    <thead>
                        <tr>
                            <th class="py-2">Date</th>
                            <th class="py-2">Activity</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for operation in group.operations|json_loads %}
                        <tr>
                            <td class="border px-4 py-2">{{ operation.date }}</td>
                            <td class="border px-4 py-2">
                                {% for line in operation.activity.split('\n') %}
                                    {% if 'http' in line %}
                                        <a href="{{ line }}" target="_blank" rel="noopener" class="text-blue-500 underline">{{ line }}</a><br>
                                    {% else %}
                                        {{ line }}<br>
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
            
            {% if group.counter_operations %}
            <div class="mb-4">
                <h2 class="text-2xl font-semibold mb-2">Counter Operations:</h2>
                <table class="min-w-full bg-white">
                    <thead>
                        <tr>
                            <th class="py-2">Date</th>
                            <th class="py-2">Activity</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for operation in group.counter_operations|json_loads %}
                        <tr>
                            <td class="border px-4 py-2">{{ operation.date }}</td>
                            <td class="border px-4 py-2">
                                {% for line in operation.activity.split('\n') %}
                                    {% if 'http' in line %}
                                        <a href="{{ line }}" target="_blank" rel="noopener" class="text-blue-500 underline">{{ line }}</a><br>
                                    {% else %}
                                        {{ line }}<br>
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
            
            {% if group.mitre_attack and group.mitre_attack.strip() %}
            <div class="mb-4">
                <h2 class="text-2xl font-semibold mb-2">MITRE ATT&amp;CK Techniques:</h2>
                <ul class="list-disc list-inside">
                    {% for technique in group.mitre_attack.split(', ') %}
                    {% if technique.strip() %}
                    <li>
                        <a href="https://attack.mitre.org/techniques/{{ technique.strip() }}/" target="_blank" class="text-blue-500 hover:underline">
                            {{ technique.strip() }}
                        </a>
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <p class="text-sm text-gray-500 mt-4"><strong>Last Updated:</strong> {{ group.last_card_change }}</p>
        </div>
    </div>
    
    <div class="mt-8 text-center">
        <a href="{{ url_for('apt.apt_groups') }}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            Back to APT Groups
        </a>
    </div>
</div>
{% endblock %}
